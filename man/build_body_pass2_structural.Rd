% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/register_build_input.R
\name{build_body_pass2_structural}
\alias{build_body_pass2_structural}
\title{Build Pass-2 body}
\usage{
build_body_pass2_structural(pass1_body, optional_keys = NULL)
}
\arguments{
\item{pass1_body}{list (raw). The raw Pass-1 input body from endpoint analysis.}

\item{optional_keys}{Character vector of explicit optional parameter keys to remove.
If \code{NULL}, defaults to \code{default_optional_keys()}.}
}
\value{
A list representing the normalized Pass-2 body, ready for YAML registry serialization.
}
\description{
Normalize and simplify a raw Pass-1 request body into a structured Pass-2 form,
retaining vendor fields and removing runtime-tunable optionals.
The resulting body is schema-clean and suitable for registry serialization.
}
\details{
**Rules**
\itemize{
  \item \strong{Messages style}: rebuild the messages *container* into a single message using
    the same field names inferred from the placeholder \code{"\${CONTENT}"} (no guessing);
    keep all other top-level fields from Pass-1 except optionals.
  \item \strong{Single-prompt style}: keep the original key (e.g., \code{prompt}, \code{input});
    remove optionals and retain other top-level fields.
  \item Always ensure \code{model} is present (prefer Pass-1; else use \code{model_guess};
    otherwise \code{NA}).
  \item Append a clean merge point \code{"\${PARAMETER}: \${VALUE}"} at the top level
    to mark where optional parameters are injected.
}
}
\seealso{
\link{strip_optionals_from_body}, \link{infer_structure_from_placeholder}
}
