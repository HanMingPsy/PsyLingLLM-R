% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/factorial_trial_experiment.R
\name{factorial_trial_experiment}
\alias{factorial_trial_experiment}
\title{Run Factorial Trial Experiment (Carrier Sentence + Critical Word Filling)}
\usage{
factorial_trial_experiment(
  data,
  factors,
  CW = NULL,
  fill_method,
  trial_prompt = "",
  repeats = 1,
  random = FALSE,
  role_mapping = list(user = "user", system = "system", assistant = "assistant"),
  system_prompt = "You are a participant in a psychology experiment.",
  api_key,
  model,
  api_url,
  max_tokens = 512,
  temperature = 0.7,
  enable_thinking = TRUE,
  delay = 1,
  output_path = "experiment_results.csv"
)
}
\arguments{
\item{data}{data.frame with columns `Item` and `Material`.}

\item{factors}{list of factors, e.g. `list(Congruity = c("Congruent","Incongruent"))`.}

\item{CW}{data.frame with `Item` and columns corresponding to factor-level combinations (wide format).}

\item{fill_method}{function(condition, Material, CW_word) -> Material.}

\item{trial_prompt}{string or function.}

\item{repeats}{integer, number of repetitions per trial.}

\item{random}{logical, whether to randomize trial order.}

\item{role_mapping}{list of role names for LLM call.}

\item{system_prompt}{string, global system message for LLM.}

\item{api_key}{string, API key.}

\item{model}{string, LLM model name.}

\item{api_url}{string, API endpoint.}

\item{max_tokens}{integer, maximum tokens for response.}

\item{temperature}{numeric, sampling temperature.}

\item{enable_thinking}{logical, whether to enable model thinking trace.}

\item{delay}{numeric, delay (in seconds) between trials.}

\item{output_path}{string, file path to save experiment results.}
}
\value{
data.frame with columns:
`Run`, `Item`, `Material`, factor columns, `Word`, `Carrier_Sentence`,
`TrialPrompt`, `Response`, `Think`, `ModelName`, `ResponseTime`.
}
\description{
Supports multiple carrier sentences, factors, and CW mappings.
Automatically generates `Carrier_Sentence` from carrier sentence and CW word.
Supports trial prompt as a string or a function.
}
\examples{
data <- data.frame(Item = 1:2, Material = c("Sentence A", "Sentence B"))
factors <- list(Congruity = c("Congruent", "Incongruent"))
CW <- data.frame(Item = 1:2,
                 Congruent = c("dog", "cat"),
                 Incongruent = c("car", "chair"))
fill_method <- function(cond, Material, CW_word) paste(Material, CW_word)
factorial_trial_experiment(data, factors, CW, fill_method,
                           trial_prompt = "Read carefully.",
                           model = "gpt-4", api_key = "YOUR_KEY", api_url = "https://api.openai.com/v1/chat/completions")

}
